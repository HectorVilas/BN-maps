(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();async function E(c){const t=await(await fetch(c)).json(),a={floors:[]},e=[];return t.forEach(n=>{e.includes(n.om_terrain)||e.push(n.om_terrain)}),e.forEach(()=>a.floors.push([])),t.forEach(n=>{const r=e.indexOf(n.om_terrain);a.floors[r].push(n)}),a}async function w(c,o,t){const a=o;(await(await fetch(`../../gfx/${c}/tile_config.json`)).json()).tile_info[0],t!=null&&t.palettes&&t.palettes.forEach(async r=>{console.log(r);let l;try{l=await fetch(`../../json/mapgen_palettes/${r}.json`)}catch(i){console.log(i)}const s=await l.json();console.log(s)});for(const r in a)Object.hasOwn(a,r)&&(a[r]="linear-gradient(45deg, darkgray, gray)");return a}async function v(c,o,t){var d,u,g;const a=document.createElement("div"),e=await c.floors[o][t],n=e.object.rows,r=n[0].length,l=n.length,s={};let i={};(d=e==null?void 0:e.object)!=null&&d.terrain&&(s.terrain=e.object.terrain),(u=e==null?void 0:e.object)!=null&&u.furniture&&(s.furniture=e.object.furniture),(g=e==null?void 0:e.object)!=null&&g.palettes&&(s.palettes=e.object.palettes),n.forEach(f=>{f.split("").forEach(m=>{i[m]={terrain:void 0,furniture:void 0,items:void 0,place_loot:void 0}})}),i=await w("BrownLikeBears",i,s);for(let f=0;f<l;f+=1){const m=document.createElement("div");m.classList.add("row");for(let h=0;h<r;h+=1){const y=e.object.rows[f][h],p=document.createElement("div");p.classList.add("tile"),p.dataset.x=h,p.dataset.y=f,p.textContent=`${y}`,p.style.background=i[y],m.append(p)}a.append(m)}return a}async function L(c,o){const t=c,a=[];return t.blueprint.floors.reverse().forEach((e,n)=>{const r=document.createElement("div");r.classList.add("floor-btn-div"),r.style.zIndex=n*-1;const l=document.createElement("p");if(l.classList.add("floor-om-terrain"),l.textContent=e[0].om_terrain,e.length>1){const i=document.createElement("span");i.textContent=` (${e.length} variants)`,l.append(i)}const s=document.createElement("div");if(s.classList.add("floor-btn"),s.value=l.textContent,s.value.includes("_roof")&&s.classList.add("roof"),s.value.includes("_basement")&&s.classList.add("basement"),[s,l].forEach(i=>{i.addEventListener("click",async()=>{const d=document.querySelector(`#${o}`);t.floor=n,t.variant=0,d.replaceChildren(await v(t.blueprint,t.floor,t.variant))})}),r.append(s,l),e.length>1){const i=document.createElement("div");i.classList.add("floor-btn-next"),i.textContent=">";const d=document.createElement("div");d.classList.add("floor-btn-prev"),d.textContent="<",i.addEventListener("click",async()=>{const u=document.querySelector(`#${o}`);t.floor!==n&&(t.variant=0),t.floor=n,t.variant+=1,e[t.variant]||(t.variant=0),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),d.addEventListener("click",async()=>{const u=document.querySelector(`#${o}`);t.floor=n,t.variant-=1,e[t.variant]||(t.variant=e.length-1),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),r.append(i,d)}a.push(r)}),a}async function j(c){const o={blueprint:[],floor:0,variant:0};o.blueprint=await E(c);const t=document.createElement("button");t.textContent="Back to list",t.addEventListener("click",()=>{window.location.reload()});const a=document.createElement("section"),e=document.createElement("div");e.id="map-viewer";const n=document.createElement("div");return n.id="map-floors",n.replaceChildren(...await L(o,e.id)),e.append(await v(o.blueprint,o.floor,o.variant)),a.append(t,e,n),a}function b(c,o){const t=document.createElement("div");t.classList.add("mapgen-list-folder");const a=document.createElement("h2"),e=document.createElement("ul");a.textContent=o,t.append(a,e);for(const n in c)Object.hasOwn(c,n)&&(console.log(n),Array.isArray(c[n])?c[n].forEach((r,l)=>{const s=document.createElement("li");s.textContent=r.split("/").at(-2).split(".json").at(0),s.title=c[n][l],s.addEventListener("click",async()=>{const i=`./bn-maps/${r}`;console.log(i),document.querySelector("#app").replaceChildren(await j(i))}),e.append(s)}):t.append(b(c[n],n)));return t}async function x(){const o=await(await fetch("../../bn-maps/fileList/mapgen.json")).json();return console.log(o),b(o,"root")}async function C(){const c=document.createElement("main"),o=document.createElement("h1");o.textContent="BN Maps";const t=document.createElement("div");return t.append(await x()),c.append(o,t),c}const O=document.querySelector("#app");async function P(){O.append(await C())}P();
