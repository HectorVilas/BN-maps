(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();async function E(r){const t=await(await fetch(r)).json(),o={floors:[]},e=[];return t.forEach(n=>{e.includes(n.om_terrain)||e.push(n.om_terrain)}),e.forEach(()=>o.floors.push([])),t.forEach(n=>{const c=e.indexOf(n.om_terrain);o.floors[c].push(n)}),o}async function w(r,a,t){const o=a;(await(await fetch(`../../gfx/${r}/tile_config.json`)).json()).tile_info[0],t!=null&&t.palettes&&t.palettes.forEach(async c=>{console.log(c);let l;try{l=await fetch(`../../json/mapgen_palettes/${c}.json`)}catch(s){console.log(s)}const i=await l.json();console.log(i)});for(const c in o)Object.hasOwn(o,c)&&(o[c]="linear-gradient(45deg, darkgray, gray)");return o}async function v(r,a,t){var d,u,y;const o=document.createElement("div"),e=await r.floors[a][t],n=e.object.rows,c=n[0].length,l=n.length,i={};let s={};(d=e==null?void 0:e.object)!=null&&d.terrain&&(i.terrain=e.object.terrain),(u=e==null?void 0:e.object)!=null&&u.furniture&&(i.furniture=e.object.furniture),(y=e==null?void 0:e.object)!=null&&y.palettes&&(i.palettes=e.object.palettes),n.forEach(f=>{f.split("").forEach(m=>{s[m]={terrain:void 0,furniture:void 0,items:void 0,place_loot:void 0}})}),s=await w("BrownLikeBears",s,i);for(let f=0;f<l;f+=1){const m=document.createElement("div");m.classList.add("row");for(let h=0;h<c;h+=1){const g=e.object.rows[f][h],p=document.createElement("div");p.classList.add("tile"),p.dataset.x=h,p.dataset.y=f,p.textContent=`${g}`,p.style.background=s[g],m.append(p)}o.append(m)}return o}async function L(r,a){const t=r,o=[];return t.blueprint.floors.reverse().forEach((e,n)=>{const c=document.createElement("div");c.classList.add("floor-btn-div"),c.style.zIndex=n*-1;const l=document.createElement("p");if(l.classList.add("floor-om-terrain"),l.textContent=e[0].om_terrain,e.length>1){const s=document.createElement("span");s.textContent=` (${e.length} variants)`,l.append(s)}const i=document.createElement("div");if(i.classList.add("floor-btn"),i.value=l.textContent,i.value.includes("_roof")&&i.classList.add("roof"),i.value.includes("_basement")&&i.classList.add("basement"),[i,l].forEach(s=>{s.addEventListener("click",async()=>{const d=document.querySelector(`#${a}`);t.floor=n,t.variant=0,d.replaceChildren(await v(t.blueprint,t.floor,t.variant))})}),c.append(i,l),e.length>1){const s=document.createElement("div");s.classList.add("floor-btn-next"),s.textContent=">";const d=document.createElement("div");d.classList.add("floor-btn-prev"),d.textContent="<",s.addEventListener("click",async()=>{const u=document.querySelector(`#${a}`);t.floor!==n&&(t.variant=0),t.floor=n,t.variant+=1,e[t.variant]||(t.variant=0),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),d.addEventListener("click",async()=>{const u=document.querySelector(`#${a}`);t.floor=n,t.variant-=1,e[t.variant]||(t.variant=e.length-1),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),c.append(s,d)}o.push(c)}),o}async function x(r){console.log(r);const a={blueprint:[],floor:0,variant:0};a.blueprint=await E(r);const t=document.createElement("button");t.textContent="Back to list",t.addEventListener("click",()=>{window.location.reload()});const o=document.createElement("section"),e=document.createElement("div");e.id="map-viewer";const n=document.createElement("div");return n.id="map-floors",n.replaceChildren(...await L(a,e.id)),e.append(await v(a.blueprint,a.floor,a.variant)),o.append(t,e,n),o}function b(r,a){const t=document.createElement("div");t.classList.add("mapgen-list-folder");const o=document.createElement("h2"),e=document.createElement("ul");o.textContent=a,t.append(o,e);for(const n in r)Object.hasOwn(r,n)&&(Array.isArray(r[n])?r[n].forEach((c,l)=>{const i=document.createElement("li");i.textContent=c.split("/").at(-2).split(".json").at(0),i.title=r[n][l],i.addEventListener("click",async()=>{const s=`./${c}`;document.querySelector("#app").replaceChildren(await x(s))}),e.append(i)}):t.append(b(r[n],n)));return t}async function j(){const a=await(await fetch("../../bn-maps/fileList/mapgen.json")).json();return b(a,"root")}async function C(){const r=document.createElement("main"),a=document.createElement("h1");a.textContent="BN Maps";const t=document.createElement("div");return t.append(await j()),r.append(a,t),r}const O=document.querySelector("#app");async function P(){O.append(await C())}P();
