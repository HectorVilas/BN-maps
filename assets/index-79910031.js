(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();async function b(c){const t=await(await fetch(c)).json(),o={floors:[]},e=[];return t.forEach(n=>{e.includes(n.om_terrain)||e.push(n.om_terrain)}),e.forEach(()=>o.floors.push([])),t.forEach(n=>{const r=e.indexOf(n.om_terrain);o.floors[r].push(n)}),o}async function w(c,a,t){const o=a;(await(await fetch(`../../gfx/${c}/tile_config.json`)).json()).tile_info[0],t!=null&&t.palettes&&t.palettes.forEach(async r=>{console.log(r);let l;try{l=await fetch(`../../json/mapgen_palettes/${r}.json`)}catch(s){console.log(s)}const i=await l.json();console.log(i)});for(const r in o)Object.hasOwn(o,r)&&(o[r]="linear-gradient(45deg, darkgray, gray)");return o}async function v(c,a,t){var d,u,y;const o=document.createElement("div"),e=await c.floors[a][t],n=e.object.rows,r=n[0].length,l=n.length,i={};let s={};(d=e==null?void 0:e.object)!=null&&d.terrain&&(i.terrain=e.object.terrain),(u=e==null?void 0:e.object)!=null&&u.furniture&&(i.furniture=e.object.furniture),(y=e==null?void 0:e.object)!=null&&y.palettes&&(i.palettes=e.object.palettes),n.forEach(f=>{f.split("").forEach(m=>{s[m]={terrain:void 0,furniture:void 0,items:void 0,place_loot:void 0}})}),s=await w("BrownLikeBears",s,i);for(let f=0;f<l;f+=1){const m=document.createElement("div");m.classList.add("row");for(let h=0;h<r;h+=1){const g=e.object.rows[f][h],p=document.createElement("div");p.classList.add("tile"),p.dataset.x=h,p.dataset.y=f,p.textContent=`${g}`,p.style.background=s[g],m.append(p)}o.append(m)}return o}async function L(c,a){const t=c,o=[];return t.blueprint.floors.reverse().forEach((e,n)=>{const r=document.createElement("div");r.classList.add("floor-btn-div"),r.style.zIndex=n*-1;const l=document.createElement("p");if(l.classList.add("floor-om-terrain"),l.textContent=e[0].om_terrain,e.length>1){const s=document.createElement("span");s.textContent=` (${e.length} variants)`,l.append(s)}const i=document.createElement("div");if(i.classList.add("floor-btn"),i.value=l.textContent,i.value.includes("_roof")&&i.classList.add("roof"),i.value.includes("_basement")&&i.classList.add("basement"),[i,l].forEach(s=>{s.addEventListener("click",async()=>{const d=document.querySelector(`#${a}`);t.floor=n,t.variant=0,d.replaceChildren(await v(t.blueprint,t.floor,t.variant))})}),r.append(i,l),e.length>1){const s=document.createElement("div");s.classList.add("floor-btn-next"),s.textContent=">";const d=document.createElement("div");d.classList.add("floor-btn-prev"),d.textContent="<",s.addEventListener("click",async()=>{const u=document.querySelector(`#${a}`);t.floor!==n&&(t.variant=0),t.floor=n,t.variant+=1,e[t.variant]||(t.variant=0),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),d.addEventListener("click",async()=>{const u=document.querySelector(`#${a}`);t.floor=n,t.variant-=1,e[t.variant]||(t.variant=e.length-1),u.replaceChildren(await v(t.blueprint,t.floor,t.variant))}),r.append(s,d)}o.push(r)}),o}async function j(c){const a={blueprint:[],floor:0,variant:0};a.blueprint=await b(c);const t=document.createElement("button");t.textContent="Back to list",t.addEventListener("click",()=>{window.location.reload()});const o=document.createElement("section"),e=document.createElement("div");e.id="map-viewer";const n=document.createElement("div");return n.id="map-floors",n.replaceChildren(...await L(a,e.id)),e.append(await v(a.blueprint,a.floor,a.variant)),o.append(t,e,n),o}function E(c,a){const t=document.createElement("div");t.classList.add("mapgen-list-folder");const o=document.createElement("h2"),e=document.createElement("ul");o.textContent=a,t.append(o,e);for(const n in c)Object.hasOwn(c,n)&&(Array.isArray(c[n])?c[n].forEach((r,l)=>{console.log(r);const i=document.createElement("li");i.textContent=r.split("/").at(-2).split(".json").at(0),i.title=c[n][l],i.addEventListener("click",async()=>{const s=`./${r}`;document.querySelector("#app").replaceChildren(await j(s))}),e.append(i)}):t.append(E(c[n],n)));return t}async function x(){const a=await(await fetch("../../fileList/mapgen.json")).json();return E(a,"root")}async function C(){const c=document.createElement("main"),a=document.createElement("h1");a.textContent="BN Maps";const t=document.createElement("div");return t.append(await x()),c.append(a,t),c}const O=document.querySelector("#app");async function P(){O.append(await C())}P();
